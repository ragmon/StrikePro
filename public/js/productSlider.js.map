{"version":3,"names":[],"mappings":"","sources":["productSlider.js"],"sourcesContent":["$(document).ready(function () {\n    var defaultImage = 'http://cdn.strikepro.ru/default_group.png';\n    var Body = $(\"body\");\n    var characteristicsList = $('.characteristics__list');\n    var GalleryWrap = $('.colorTable__gallery--wrapper');\n    var galleryPhotoList = $('.variation__list');\n    var GalleryMainPhoto = $('.colorTable__gallery--img');\n\n    var colorTable = $('.colorTable');\n    var colorTableItem = [];\n    var sliderItem = [];\n    var GlideSlides = $('.glide__slides');\n    var GlideSlidesList = [];\n\n    var IndexCurrentSlide = 0;\n    var $panzoom;\n    var GlideSliderConfig = {\n        startAt: IndexCurrentSlide,\n        perView: 6,\n        type: 'slider',\n        breakpoints: {\n            1920: {\n                perView: 6\n            },\n            1600: {\n                perView: 5\n            },\n            992: {\n                perView: 4\n            },\n            768: {\n                perView: 3\n            }\n        }\n    };\n    var GlideSlider = null;\n\n\n    var GlideInit = false;\n\n\n    /** @desc рендер списка вариантов артикла, принимает на вход массив */\n    function colorTableItemRender(id, image, data, classWrapper) {\n        var title = '';\n        var ultraviolet = false;\n        var ClassWrapper = classWrapper ? classWrapper : '';\n        var luminous = false;\n        for (var i = 0; i < data.features.length; i++) {\n            if (data.features[i].title === 'Код цвета') {\n                title = data.features[i].pivot.value\n            }\n            if (data.features[i].title === \"Светящийся\") {\n                console.log(\"Светящийся\", data.features[i].pivot.value === 'Да');\n                luminous = data.features[i].pivot.value === 'Да';\n            }\n            if (data.features[i].title === \"Ультрафиолет\") {\n                ultraviolet = data.features[i].pivot.value === 'Да';\n            }\n        }\n\n\n        return ('<div class=\"colorTable__item ' + ClassWrapper + '\" id=\"' + id + '\">' +\n            '<div class=\"colorTable__img\">' +\n            '<img src=\"' + image + '\" alt=\"\">' +\n            (ultraviolet ? '<div class=\"colorTable__marker colorTable__marker--ultraviolet\"></div>' : '') +\n            (luminous ? '<div class=\"colorTable__marker colorTable__marker--luminous\"></div>' : '') +\n            '</div>' +\n            '<span>' + title + '</span>' +\n            '</div>')\n    }\n\n    /** @desc рендер списка характеристик, принимает на вход массив */\n    function descriptionRender(array) {\n        var features = [];\n        $(characteristicsList).empty();\n        for (var i = 0; i < array.length; i++) {\n            if (parseInt(array[i].is_visible) === 1) {\n                var feature = '<li class=\"characteristics__item\">' +\n                    '<span class=\"characteristics__title\">' + array[i].title + '</span>' +\n                    '<span class=\"characteristics__desc\">' + array[i].pivot.value + '</span>' +\n                    '</li>';\n                features.push(feature);\n            }\n        }\n        $(characteristicsList).append(features);\n    }\n\n    /** @desc инициализация списка харктеристик по id артикла */\n    function initDescription(id) {\n        for (var i = 0; i < articles.length; i++) {\n            if (articles[i].id === parseInt(id)) {\n                console.log(id);\n                console.log(articles[i].features);\n                descriptionRender(articles[i].features);\n            }\n        }\n    }\n\n    /** @desc рендер списка артиклей в слайдере */\n    function sliderItemRender(image, id, data, index) {\n        console.log(index);\n        var title = '';\n        var ultraviolet = false;\n        var luminous = false;\n        for (var i = 0; i < data.features.length; i++) {\n            if (data.features[i].title === 'Код цвета') {\n                title = data.features[i].pivot.value\n            }\n            if (data.features[i].title === \"Светящийся\") {\n                console.log(\"Светящийся\", data.features[i].pivot.value === 'Да');\n                luminous = data.features[i].pivot.value === 'Да';\n            }\n            if (data.features[i].title === \"Ультрафиолет\") {\n                ultraviolet = data.features[i].pivot.value === 'Да';\n            }\n        }\n        return (\n            '<li data-key=\"' + index + '\" class=\"slider__item glide__slide\" id=\"' + id + '\"> ' +\n            '<a href=\"#!\"  class=\"slider__link\" >' +\n            '<img src=\"' + image + '\" />' +\n            (ultraviolet ? '<div class=\"colorTable__marker colorTable__marker--ultraviolet\"></div>' : '') +\n            (luminous ? '<div class=\"colorTable__marker colorTable__marker--luminous\"></div>' : '') +\n            '</a>' +\n            '<span class=\"slider__item-title\">' + title + '</span> ' +\n            '</li>'\n        )\n    }\n\n    function CreateArticlesTable() {\n        try {\n            $(colorTable).empty();\n            $(colorTable).after(\"<div class='colorTable _mobile'></div>\");\n\n            for (var i = 0; i < articles.length; i++) {\n                if (articles[i].logo) {\n                    colorTableItem.push(colorTableItemRender(articles[i].id, articles[i].logo.thumb_url ? articles[i].logo.thumb_url : defaultImage, articles[i]));\n                } else {\n                    colorTableItem.push(colorTableItemRender(articles[i].id, defaultImage, articles[i]));\n                }\n            }\n            $(colorTable).append(colorTableItem);\n            $('.colorTable._mobile').append(colorTableItem);\n\n            $('.colorTable .colorTable__item').on('click', initGallery);\n\n        } catch (err) {\n            throw new Error(err);\n        }\n    }\n\n    /** @desc смена главного изображения по id артикла */\n    function initGalleryMainPhoto(id) {\n        var ultraviolet = false;\n        var luminous = false;\n        for (var i = 0; i < articles.length; i++) {\n            if (articles[i].id === parseInt(id)) {\n                for (var a = 0; a < articles[i].features.length; a++) {\n                    if (articles[i].features[a].title === \"Светящийся\") {\n                        console.log(\"Светящийся\", articles[i].features[a].pivot.value === 'Да');\n                        luminous = articles[i].features[a].pivot.value === 'Да';\n                    }\n                    if (articles[i].features[a].title === \"Ультрафиолет\") {\n                        ultraviolet = articles[i].features[a].pivot.value === 'Да';\n                    }\n                }\n                $(GalleryMainPhoto).empty();\n                console.log('articles[i]: ', articles[i]);\n                if (articles[i].logo) {\n                    $(GalleryMainPhoto).addClass('colorTable__gallery--img--loading');\n                    // .colorTable__gallery--img--loading\n                    var img = new Image();\n                    img.onload = function () {\n                        $(GalleryMainPhoto).removeClass('colorTable__gallery--img--loading');\n                        console.log(\"image is loaded\");\n                    }\n                    img.src = articles[i].logo.original_url;\n                    $(GalleryMainPhoto).append('<img src=\"' + articles[i].logo.original_url + '\" alt=\"\">');\n\n                } else {\n                    $(GalleryMainPhoto).append('<img src=\"' + defaultImage + '\" alt=\"\">');\n\n                }\n\n                if (luminous) {\n                    $(GalleryMainPhoto).append('<div class=\"colorTable__gallery__marker colorTable__gallery__marker--luminous\"></div>');\n                }\n                if (ultraviolet) {\n                    $(GalleryMainPhoto).append('<div class=\"colorTable__gallery__marker colorTable__gallery__marker--ultraviolet\"></div>');\n                }\n            }\n        }\n    }\n\n    /** @desc рендер списка вариантов артикла, принимает на вход массив */\n    function gelleryPhotoRender(Array) {\n        var photos = [];\n        var array = Array;\n\n        if (array === undefined) {\n            return null;\n        }\n        if (array.length > 1) {\n            for (var i = 0; i < array.length; i++) {\n                var photo = '<li class=\"variation__item\">' +\n                    '<img id=\"' + array[i].id + '\" src=\"' + array[i].thumb_url + '\" alt=\"\">' +\n                    '</li>';\n                photos.push(photo);\n            }\n            $(galleryPhotoList).append(photos);\n            $('.colorTable__gallery--variation').addClass('active');\n\n            $('.variation__item img').on('click', function () {\n                initGalleryMainPhoto($(this).attr('id'));\n\n                $(GalleryMainPhoto).css({\n                    'transform': 'none'\n                })\n            })\n        } else {\n            return null;\n        }\n    }\n\n    /** @desc смена главного изображения по id артикла*/\n    function initPhotos(id) {\n        $(galleryPhotoList).empty();\n        for (var i = 0; i < articles.length; i++) {\n            if (articles[i].id === parseInt(id)) {\n                initGalleryMainPhoto(articles[i].id);\n                console.log(articles[i]);\n                gelleryPhotoRender(articles[i].head_images);\n            }\n        }\n    }\n\n    function initGallery() {\n        var windowSize = window.innerWidth;\n        if (windowSize >= 768) {\n            CreateSliderItems();\n            $(GalleryWrap).show();\n            GlideSlider = new Glide('.glide', GlideSliderConfig);\n            $(Body).css({\n                \"overflow\": \"hidden\"\n            });\n\n            console.log('GlideInit: ', GlideInit);\n            if (!GlideInit) {\n                console.log('GlideSlider.mount():');\n                GlideSlider.mount();\n            }\n            if (!GlideInit) {\n                GlideInit = true;\n\n                GlideSlider.on(['mount.before', 'run'], function (event) {\n                    console.log(['mount.before', 'run'], event);\n                    switch (event.direction) {\n                        case('>'): {\n                            if (IndexCurrentSlide === $('.glide__slides')[\"0\"].children.length - 1) {\n                                IndexCurrentSlide = 0;\n                            } else {\n                                IndexCurrentSlide += 1;\n                            }\n                            onActivePhoto($($('.glide__slides')[\"0\"].children[IndexCurrentSlide]).attr('id'));\n                            break\n                        }\n                        case('<'): {\n                            if (IndexCurrentSlide === 0) {\n                                IndexCurrentSlide = $('.glide__slides')[\"0\"].children.length - 1;\n                            } else {\n                                IndexCurrentSlide -= 1;\n                            }\n                            onActivePhoto($($('.glide__slides')[\"0\"].children[IndexCurrentSlide]).attr('id'));\n\n                            break\n                        }\n                    }\n                })\n\n                $(\".slider__item\").on('click', function () {\n                    IndexCurrentSlide = $('.slider__item').index(this);\n                    GlideSlider.go('=' + IndexCurrentSlide);\n                    onActivePhoto($(this).attr('id'));\n                });\n\n            }\n            IndexCurrentSlide = $('.colorTable__item').index(this);\n            GlideSlider.go('=' + IndexCurrentSlide);\n\n\n            return initSlider(this);\n        }\n        return false;\n    }\n\n    /** @desc инициализация слайдера */\n    function initSlider(event) {\n        sliderItem = [];\n        console.log($(event));\n        initDescription($(event).attr('id'));\n        initPhotos($(event).attr('id'));\n        PanZoomInit();\n    }\n\n    /** @desc активация элемента списка по id артикла */\n    function onActivePhoto(id) {\n        initDescription(id);\n        initPhotos(id);\n\n        $(GalleryMainPhoto).css({\n            'transform': 'none'\n        });\n        PanZoomInit();\n    }\n\n    function CreateSliderItems() {\n        try {\n            console.log('CreateSliderItems:');\n            var windowSize = window.innerWidth;\n            if (windowSize >= 768) {\n                $(GlideSlides).empty();\n\n                for (var i = 0; i < articles.length; i++) {\n                    if (articles[i].logo) {\n                        GlideSlidesList.push(sliderItemRender(articles[i].logo.thumb_url, articles[i].id, articles[i], i))\n                    } else {\n                        GlideSlidesList.push(sliderItemRender(defaultImage, articles[i].id, articles[i], i))\n                    }\n                }\n                $(GlideSlides).append(GlideSlidesList);\n                $('.slider__link').on('click', function (event) {\n                    event.preventDefault();\n                })\n            }\n        } catch (err) {\n            throw new Error(err);\n        }\n\n    }\n\n    function PanZoomInit() {\n        $panzoom = $(GalleryMainPhoto).find('img').panzoom();\n        $panzoom.parent().on('mousewheel.focal', function (e) {\n            e.preventDefault();\n            var delta = e.delta || e.originalEvent.wheelDelta;\n            var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;\n            $panzoom.panzoom('zoom', zoomOut, {\n                increment: 0.1,\n                animate: false,\n                focal: e,\n                minScale: 1\n            });\n        });\n    }\n\n    function colorTable_item_slider() {\n        var colorTableItemMobile = $('.colorTable._mobile .colorTable__item');\n        var colorTableItemMobileLength = colorTableItemMobile.length;\n        for (var i = 0; i < colorTableItemMobileLength; i++) {\n\n\n            var slides = [];\n            var classNav = \".custom-navigation-\" + i + \" a\";\n            var photos = articles[i].head_images;\n            var photosLength = photos.length;\n            console.log('articles[i]', articles[i]);\n            if (photosLength < 2) continue;\n\n            var sliderWrap = document.createElement('div'),\n                sliderList = document.createElement('ul');\n            $(sliderWrap).addClass('slider-' + i);\n            $(sliderList).addClass('slides');\n            for (var a = 0; a < photosLength; a++) {\n                var li = document.createElement('li'),\n                    img = document.createElement('img'),\n                    span = document.createElement('span');\n                $(span).text(photos[a].title);\n                $(img).attr('src', photos[a].original_url);\n                $(li).append(img);\n                $(li).append(span);\n                slides.push(li)\n            }\n\n            $(sliderList).append(slides);\n            $(sliderWrap).append(sliderList);\n            $(sliderWrap).append('<div class=\"flex-direction-nav ' + \"custom-navigation-\" + i + '\">' +\n                '<a href=\"!#\" class=\"flex-prev\">' +\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\n                '</a>' +\n                '<a href=\"!#\" class=\"flex-next\">' +\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\n                '</a>' +\n                '</div>');\n\n\n            $(colorTableItemMobile[i]).empty();\n            $(colorTableItemMobile[i]).append(sliderWrap);\n\n            $(sliderWrap).flexslider({\n                animation: \"slide\",\n                slideshow: false,\n                touch: true,\n                directionNav: true,\n                controlNav: false,\n                customDirectionNav: $(classNav)\n            });\n\n        }\n    }\n\n    try {\n\n        $('.colorTable__gallery--popup .js__closePopup').on('click', function () {\n            GlideSlider.destroy();\n            $(GlideSlides).empty();\n            GlideInit = false;\n        });\n\n        CreateArticlesTable();\n\n        // CreateSliderItems();\n\n        $(window).resize($.throttle(250, function (ev) {\n            if (window.outerWidth < 768) {\n                colorTable_item_slider();\n            }\n        }));\n\n\n    } catch (err) {\n        console.log(err)\n    }\n\n\n});\n\n// http://webcareer.ru/menyaem-aktivnyj-punkt-menyu-pri-prokrutke-stranicy.html\n// http://jsfiddle.net/mekwall/up4nu/\n\n$(document).ready(function () {\n\n    // js-btn3D\n    if (window.real3DConfig && window.real3DConfig.images) {\n        $(\".js-btn3D\").on(\"click\", function () {\n            var img3D = $('#reel-image');\n            $(img3D).reel({\n                loops: false,\n                speed: 0,\n                frames: 32,\n                revolution: 100,\n                images: window.real3DConfig ? window.real3DConfig.images : '',\n            });\n\n            $(\".img_2d\").hide();\n            $('#reel-image-reel').show();\n            $(img3D).show()\n        });\n    } else {\n        $('.js-btn3D').hide();\n    }\n\n\n    $(\".product__sliderImg ul li a\").on('click', function (event) {\n\n        var img2D = $(\".img_2d\");\n        var img3D = $('#reel-image');\n        event.preventDefault();\n        $(img2D).show();\n        $(img2D).attr(\"src\", $(this).attr(\"href\"));\n        $(img3D).hide();\n        $('#reel-image-reel').hide();\n    });\n    // $(window).resize(function () {\n    //     var k = 500 / 304,\n    //         productStand = $('.product__stand'),\n    //         w = $(document).width();\n    //\n    //     if (w < 500) {\n    //         $(productStand).height($(productStand).width() / k);\n    //     } else {\n    //         $(productStand).height('auto');\n    //     }\n    // });\n\n\n    /** @desc ШАПКА СТРАНИЦЫ ПРОДУКТА */\n    var HeaderProductWrapper = $('.header-product'),\n        HeaderProductTitle = $('.header-product__title'),\n        HeaderProductImage = $('.header-product__image img'),\n        HeaderProductNav = $('.header-product__nav'),\n        SectionTitleList = $('h4.title__xs'),\n        HeaderProductMenuList = [];\n\n    function toggleMenuLink() {\n        var lastId,\n            topMenu = $('.header-product__nav'),\n            topMenuHeight = $(topMenu).outerHeight() + 15,\n            // All list items\n            menuItems = $(topMenu).find(\"a\"),\n            // Anchors corresponding to menu items\n            scrollItems = $(menuItems).map(function () {\n                var item = $(this.hash);\n                if (item.length) {\n                    return item;\n                }\n            });\n\n// Bind click handler to menu items\n// so we can get a fancy scroll animation\n        $(menuItems).click(function (e) {\n            var href = $(this.hash);\n            offsetTop = href === \"#\" ? 0 : $(href).offset().top - topMenuHeight + 1;\n            $('html, body').stop().animate({\n                scrollTop: offsetTop\n            }, 300);\n            e.preventDefault();\n        });\n\n// Bind to scroll\n        $(window).scroll(function () {\n            // Get container scroll position\n            var fromTop = $(this).scrollTop() + topMenuHeight;\n            // Get id of current scroll item\n            var cur = $(scrollItems).map(function () {\n                if ($(this).offset().top < fromTop)\n                    return this;\n            });\n            // Get the id of the current element\n            cur = cur[cur.length - 1];\n\n            var id = cur && cur.length ? cur[0].id : \"\";\n            if (lastId !== id) {\n                lastId = id;\n                $(menuItems).parent().removeClass(\"active\");\n                $(\"[href='#\" + lastId + \"']\").parent('.header-product__item').addClass(\"active\");\n            }\n            HeaderProductToggle();\n        });\n    }\n\n    function renderMenuItem(link, content) {\n        return ('<li class=\"header-product__item\"><a href=\"#' + link + '\" class=\"header-product__link\">' + content + '</a></li>')\n    }\n\n    function init() {\n        $(HeaderProductNav).empty();\n        HeaderProductMenuList.push(renderMenuItem('main-image', 'Изображение'));\n        $(SectionTitleList).each(function (index, element) {\n            var id = 'product-section-id-' + index,\n                content = $(element).text();\n            $(element).attr(\"id\", id);\n            HeaderProductMenuList.push(renderMenuItem(id, content));\n        });\n        $(HeaderProductNav).append(HeaderProductMenuList);\n        $(HeaderProductImage).attr('src', $('.product__stand--img .img_2d').attr('src'));\n        $(HeaderProductTitle).text($('.product__title h1').text());\n\n        //TODO: Инициализация обработчика скрола\n        toggleMenuLink()\n\n    }\n\n\n    init();\n\n    function HeaderProductToggle() {\n        if (screen.width > 1023) {\n            if ($(\".img_2d\").offset().top < window.scrollY) {\n\n                $('.header__top').css({top: '-150px'});\n                $('.header-product').css({top: '0'});\n            } else {\n                $('.header__top').css({top: '0'});\n                $('.header-product').css({top: '-150px'});\n\n            }\n        }\n    }\n\n});\n\n\n//TODO: Gallery\n$(document).ready(function () {\n    try {\n        $('.product-gallery_list').magnificPopup({\n            delegate: 'li a',\n            type: 'image',\n            tLoading: 'Loading image #%curr%...',\n            mainClass: 'mfp-img-mobile',\n            gallery: {\n                enabled: true,\n                arrowMarkup: '<button title=\"%title%\" type=\"button\" onclick=\"event.stopPropagation()\" class=\"product-gallery_arrow mfp-arrow mfp-arrow-%dir% mfp-prevent-close product-gallery_arrow-%dir%\"><svg ><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"arrow\"></use></svg></button>', // markup of an arrow button\n                tCounter: '%curr% из %total%',\n                navigateByImgClick: true,\n                preload: [0, 1] // Will preload 0 - before current, and 1 after the current image\n            },\n            image: {\n                titleSrc: function (item) {\n                    return item.el.attr('title');\n                }\n            },\n            zoom: {\n                enabled: true,\n                duration: 200, // don't foget to change the duration also in CSS\n                opener: function (element) {\n                    return element.find('img');\n                }\n            }\n        });\n    } catch (err) {\n        throw new Error(err);\n\n    }\n\n});\n"],"file":"productSlider.js"}